$(document).ready(()=>{reportAdImpressions=!1;let isDirty=!1;let company=null;let onReview=0;pausedWarningCollection=$('#pausedWarningCollection');reviewingWarningCollection=$('#reviewingWarningCollection');function attachADsActions(){$('button[data-ad]').on('click',(event)=>{button=$(event.currentTarget);$('#confirmAdRemovalBtn').data({'ad':button.data('ad')});$('#requestRemovalModal').modal('open')})}
$('select').on('change',function(){value=$(this).val();COMPANIES.forEach((currentCompany)=>{if(value==currentCompany.id){company=currentCompany;return}})});$('select').trigger('change').formSelect();$('.select-dropdown').addClass('light-4 dark-5').find('span').addClass('light-4 dark-5');$('input').on('keyup change',()=>{content=$('#content').val();$('#adPreview').html(getRenderedAd(null,content.length>0?content:'Contenido del anuncio',company.name,null,null,'s12 m8 offset-m2'))}).trigger('change');$('#content').on('keyup change',function(){if($(this).val().length>0){markValid($(this));isDirty=!0}else{markInvalid($(this));isDirty=!1}});$('#createAdBtn').on('click',()=>{content=$('#content');if(content.hasClass('valid')){run('adsManager','createAd',{'company':company.id,'content':content.val()},()=>{disable($('#createAdBtn'))}).done((response)=>{console.info(response);switch(response.status){case OK:container=$('.gridContainer');container.find('.removableWarning').fadeOut(()=>{container.prepend(getRenderedAd(response.result.id,content.val(),company.name,null,null,'s12 onReview',company.isBillingEnabled==1?{bgClass:'orange darken-3 dark-5 light-10',text:'En revisión'}:{bgClass:'light-blue darken-2 dark-5 light-10',text:'En pausa'},null,!0));reloadLayout();content.val('').removeClass('valid invalid').trigger('change');if(company.isBillingEnabled==1){reviewingWarningCollection.show();if(reviewingWarningCollection.parent().css('opacity')==0){reviewingWarningCollection.parent().fadeIn()}else{reviewingWarningCollection.parent().slideDown()}
onReview++;collection=$('#reviewingWarningCollection');collection.find('.reviewingHint').html(onReview==1?'un':onReview);if(onReview>1){collection.find('.plurals').show()}}else{if($('.message').filter('[data-ad!="null"]').length>1){pausedWarningCollection.find('.plurals').show()}else{pausedWarningCollection.find('.plurals').hide()}
pausedWarningCollection.parent().fadeIn()}
attachADsActions();goBackToTop()});break;case ERROR:toast('Algo salió mal, por favor probá de nuevo.');break;case NOT_ALLOWED:toast('No podés hacer eso, por favor probá recargando la página.');break;case NO_SUCH_ELEMENT:toast('La empresa que seleccionaste no existe o no te pertenece.');break;default:toast('Algo salió mal, por favor probá de nuevo.')}}).always(()=>{enable($('#createAdBtn'))})}else{content.addClass('invalid');toast('No podés crear un anuncio vacío.')}});window.onbeforeunload=function(){return isDirty?'Si cerrás esta pestaña, vas a perder lo que estabas haciendo.':null}
if(company.isBillingEnabled!=1){pausedWarningCollection.show().parent().show()}
if(ADS.length>0){let adSet='';ADS.forEach((ad)=>{adSet+=getRenderedAd(ad.id,ad.content,ad.companyName,ad.created,null,'s12 '+(company.isBillingEnabled==1&&ad.approved==null?'onReview':''),company.isBillingEnabled==1?(ad.approved==null?{bgClass:'orange darken-3 dark-5 light-10',text:'En revisión'}:(ad.approved==1?{bgClass:'green darken-2 dark-5 light-10',text:'Publicado'}:{bgClass:'red dark-5 light-10',text:'No aprobado'})):{bgClass:'light-blue darken-2 dark-5 light-10',text:'En pausa'},ad.approved==null?null:(ad.approved==1?ad.impressions:null),!0);if(ad.approved==null){onReview++}});if(company.isBillingEnabled==1&&onReview>0){let collection=$('#reviewingWarningCollection');collection.show().parent().show();collection.find('.reviewingHint').html(onReview==1?'un':onReview)
if(onReview>1){collection.find('.plurals').show()}}
container=$('.gridContainer');container.find('.removableWarning').remove();container.find('.row').append(adSet);if(ADS.length>1){pausedWarningCollection.find('.plurals').show()}
attachADsActions();reloadLayout()}else{pausedWarningCollection.parent().hide();displayRemovableWarning('¡Nada por acá! Publicá tu primer anuncio.')}
$('#confirmAdRemovalBtn').on('click',(event)=>{requestRemovalModal=$('#requestRemovalModal');button=$(event.currentTarget);ad=button.data('ad');if(ad!=-1&&!isNaN(parseInt(ad))){run('adsManager','tryToRemoveAd',{'id':ad},()=>{disable(button);button.html('Eliminando')}).done((response)=>{console.info(response);switch(response.status){case OK:toast('¡Listo! El anuncio fue eliminado.');target=$('.message[data-ad="'+ad+'"]');target.fadeOut(()=>{target.remove();reloadLayout();if(company.isBillingEnabled==1){onReview=$('.onReview').length;if($('.message').filter('[data-ad!="null"]').length==0){reviewingWarningCollection.parent().fadeOut(()=>{reviewingWarningCollection.parent().hide();displayRemovableWarning('¡Nada por acá! Publicá tu primer anuncio.');$('.gridContainer').find('.removableWarning').fadeIn()})}else if(onReview==0){reviewingWarningCollection.slideUp(()=>{if(!pausedWarningCollection.is(':visible')){reviewingWarningCollection.parent().hide()}})}else{reviewingWarningCollection.find('.reviewingHint').html(onReview==1?'un':onReview);plurals=reviewingWarningCollection.find('.plurals');if(onReview>1){plurals.show()}else{plurals.hide()}}}else{pausedADs=$('.message').filter('[data-ad!="null"]');if(pausedADs.length>1){pausedWarningCollection.find('.plurals').show()}else if(pausedADs==1){pausedWarningCollection.find('.plurals').hide()}else{pausedWarningCollection.parent().fadeOut();displayRemovableWarning('¡Nada por acá! Publicá tu primer anuncio.');$('.gridContainer').find('.removableWarning').fadeIn()}}});break;case ERROR:toast('Algo salió mal, por favor probá de nuevo.');break;case NO_SUCH_ELEMENT:toast('El anuncio que intentaste eliminar no existe.');break;case NOT_ALLOWED:toast('No tenés permitido eliminar anuncios, probá recargando la página.');break}}).always(()=>{enable(button);requestRemovalModal.modal('close');setTimeout(()=>{button.html('Eliminar')},MATERIALIZE_TRANSITION_TIME)})}else{toast('Algo anda mal, por favor probá de nuevo.');requestRemovalModal.modal('close')}})})